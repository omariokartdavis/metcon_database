{% extends "base_generic.html" %}

{% block content %}
	{% if user.is_authenticated %}
		{% if user.username == instance.current_user.username or user.coach in instance.current_user.athlete.coach_set.all %}
			<h1> Add Result for {{ instance.display_workout }}</h1>
			
			<p><strong>{{ instance.display_workout }}</strong>:
			{% if instance.workout %}
				{{ instance.edited_workout_text|linebreaks }}</p>
			{% endif %}
			<form action="" method="post" enctype="multipart/form-data">
				{% csrf_token %}
				{% if instance.strength_workout %}
					{% for field in form2 %}
						{% for k, v in result_text_and_exercises.items %}
							{% if field.label == k %}
								<p><strong>{{ v.movement.name }}</strong></br >
								{% for se_set in v.set_set.all %}
									Set {{ se_set.set_number }}: {% if se_set.reps %}{{ se_set.reps }}{% else %}Max{% endif %} rep{% if se_set.reps > 1 or not se_set.reps %}s{% endif %}{% if se_set.weight %} at {{ se_set.weight|floatformat:"-1" }}{{ se_set.weight_units }}{% endif %}{% if se_set.weight_units == '%' %} of 1 rep max{% endif %}</br >
								{% endfor %}
								</p>
								<table>
									<tr><td><label><strong>{{ field.label }}:</strong></label></td>
									<td>{{ field }}</tr>
								</table>
							{% endif %}
						{% endfor %}
					{% endfor %}
					{% for field in form2 %}
							{% if field.label not in result_text_and_exercises %}
								<table>
									<tr><td><label><strong>{{ field.label }}:</strong></label></td>
									<td>{{ field }}</td></tr>
								</table>
							{% endif %}
					{% endfor %}
				{% elif instance.cardio_workout %}
					{% for field in form3 %}
						{% for k, v in result_text_and_exercises.items %}
							{% if field.label == k %}
								<p><strong>{{ v.movement.name }}</strong></br >
									{% if v.number_of_reps %}{{ v.number_of_reps }} x {% endif %}{{ v.distance }}{{ v.distance_units }}{% if v.rest %} with {{ v.rest }} seconds rest{% endif %}{% if v.pav %} at {{ v.pav }}{% endif %}</br >
									{% if v.comment %}{{ v.comment }}{% endif %}
								</p>
								<table>
									<tr><td><label><strong>{{ field.label }}:</strong></label></td>
									<td>{{ field }}</tr>
								</table>
							{% endif %}
						{% endfor %}
					{% endfor %}
					{% for field in form3 %}
							{% if field.label not in result_text_and_exercises %}
								<table>
									<tr><td><label><strong>{{ field.label }}:</strong></label></td>
									<td>{{ field }}</td></tr>
								</table>
							{% endif %}
					{% endfor %}
				{% elif instance.workout %}
					<table>
					{{ form1.as_table }}
					</table>
				{% endif %}
				<input type="submit" value="Submit" name="add result to instance">
				<input type="hidden" name="next" value="{{ request.path }}">
			</form>
		{% else %}
			<p>You do not have permission to view this page. Please login with an account that has proper permissions.</p>
		{% endif %}
	{% else %}
		<p>Please login to view this page.</p>
	{% endif %}
{% endblock %}
